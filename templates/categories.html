<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Categories â€“ MoneyMap</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div class="layout">
  <aside class="sidebar">
    <div class="sidebar-logo">ğŸ’° Money<span>Map</span></div>
    <nav>
      <a href="/dashboard"><span class="icon">ğŸ </span> Dashboard</a>
      <a href="/analysis"><span class="icon">ğŸ“Š</span> Analysis</a>
      <a href="/categories" class="active"><span class="icon">ğŸ—‚ï¸</span> Categories</a>
      <a href="/budgets"><span class="icon">ğŸ’°</span> Budgets</a>
      <a href="/investments"><span class="icon">ğŸ“ˆ</span> Investments</a>
      <a href="/trips"><span class="icon">âœˆï¸</span> Trips</a>
      <a href="/accounts"><span class="icon">ğŸ§¾</span> Accounts</a>
      <a href="/bills"><span class="icon">ğŸ””</span> Bills</a>
      <a href="/subscriptions"><span class="icon">ğŸ“º</span> Subscriptions</a>
      <a href="/emi-tracker"><span class="icon">ğŸ§®</span> EMI Tracker</a>
      <a href="/settings"><span class="icon">âš™ï¸</span> Settings</a>
    </nav>
    <div class="sidebar-bottom">
      <div class="user-chip">
        <div class="user-avatar">{{ session.get('user_name','U')[0]|upper }}</div>
        <div class="user-name">{{ session.get('user_name','User') }}</div>
      </div>
      <button class="logout-btn" onclick="location.href='/logout'">ğŸšª Logout</button>
    </div>
  </aside>
  <main class="main">
    <div class="topbar">
      <h1>ğŸ—‚ï¸ Categories</h1>
      <button class="btn btn-primary btn-sm" onclick="MM.openModal('catModal')">+ Add Category</button>
    </div>
    <div class="grid-2">
      <div class="card">
        <div class="card-title">Income Categories</div>
        <div style="font-size:.8rem;color:var(--muted);margin-bottom:1rem;">ğŸ’¡ Default categories are auto-created</div>
        <div id="incomeList"><div class="empty">Loading...</div></div>
      </div>
      <div class="card">
        <div class="card-title">Expense Categories</div>
        <div style="font-size:.8rem;color:var(--muted);margin-bottom:1rem;">ğŸ’¡ Default categories are auto-created</div>
        <div id="expenseList"><div class="empty">Loading...</div></div>
      </div>
    </div>
  </main>
</div>

<div class="modal-overlay" id="catModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Add Category</h3>
      <button class="modal-close" onclick="MM.closeModal('catModal')">âœ•</button>
    </div>
    <div class="form-group">
      <label>Category Name</label>
      <input type="text" id="catName" placeholder="e.g. Groceries">
    </div>
    <div class="form-group">
      <label>Type</label>
      <select id="catType">
        <option value="income">Income</option>
        <option value="expense">Expense</option>
      </select>
    </div>
    <button class="btn btn-primary" onclick="saveCat()">Save</button>
  </div>
</div>

<script src="/static/js/main.js"></script>
<script>
async function load() {
  const cats = await MM.get('/api/categories');
  const inc = cats.filter(c => c.type === 'income');
  const exp = cats.filter(c => c.type === 'expense');

  const render = (list) => list.length ? list.map(c => `
    <div class="flex-between" style="padding:.5rem 0;border-bottom:1px solid var(--border)">
      <span>${c.name}</span>
      <button class="btn btn-danger" onclick="delCat(${c.id})">âœ•</button>
    </div>
  `).join('') : '<div class="empty">None yet.</div>';

  document.getElementById('incomeList').innerHTML  = render(inc);
  document.getElementById('expenseList').innerHTML = render(exp);
}

async function saveCat() {
  const name = document.getElementById('catName').value.trim();
  const type = document.getElementById('catType').value;
  if (!name) return MM.toast('Name required.', 'error');
  await MM.post('/api/categories', { name, type });
  MM.closeModal('catModal');
  MM.toast('Category added!');
  load();
}

async function delCat(id) {
  if (!confirm('Delete category?')) return;
  await MM.del('/api/categories/' + id);
  MM.toast('Deleted.');
  load();
}

load();
</script>
</body>
</html>
