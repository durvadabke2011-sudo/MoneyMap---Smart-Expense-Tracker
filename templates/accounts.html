<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Accounts â€“ MoneyMap</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div class="layout">
  <aside class="sidebar">
    <div class="sidebar-logo">ğŸ’° Money<span>Map</span></div>
    <nav>
      <a href="/dashboard"><span class="icon">ğŸ </span> Dashboard</a>
      <a href="/analysis"><span class="icon">ğŸ“Š</span> Analysis</a>
      <a href="/categories"><span class="icon">ğŸ—‚ï¸</span> Categories</a>
      <a href="/budgets"><span class="icon">ğŸ’°</span> Budgets</a>
      <a href="/investments"><span class="icon">ğŸ“ˆ</span> Investments</a>
      <a href="/trips"><span class="icon">âœˆï¸</span> Trips</a>
      <a href="/accounts" class="active"><span class="icon">ğŸ§¾</span> Accounts</a>
      <a href="/bills"><span class="icon">ğŸ””</span> Bills</a>
      <a href="/subscriptions"><span class="icon">ğŸ“º</span> Subscriptions</a>
      <a href="/emi-tracker"><span class="icon">ğŸ§®</span> EMI Tracker</a>
      <a href="/settings"><span class="icon">âš™ï¸</span> Settings</a>
    </nav>
    <div class="sidebar-bottom">
      <div class="user-chip">
        <div class="user-avatar">{{ session.get('user_name','U')[0]|upper }}</div>
        <div class="user-name">{{ session.get('user_name','User') }}</div>
      </div>
      <button class="logout-btn" onclick="location.href='/logout'">ğŸšª Logout</button>
    </div>
  </aside>
  <main class="main">
    <div class="topbar">
      <h1>ğŸ§¾ Accounts</h1>
      <button class="btn btn-primary btn-sm" onclick="MM.openModal('accModal')">+ Add Account</button>
    </div>
    <div class="stats-grid" id="accCards"><div class="empty">No accounts yet.</div></div>
  </main>
</div>

<div class="modal-overlay" id="accModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Add Account</h3>
      <button class="modal-close" onclick="MM.closeModal('accModal')">âœ•</button>
    </div>
    <div class="form-group">
      <label>Account Name</label>
      <input type="text" id="accName" placeholder="e.g. SBI Savings">
    </div>
    <div class="form-group">
      <label>Type</label>
      <select id="accType">
        <option value="cash">Cash</option>
        <option value="card">Card</option>
        <option value="upi">UPI</option>
      </select>
    </div>
    <div class="form-group">
      <label>Balance (â‚¹)</label>
      <input type="number" id="accBalance" placeholder="10000">
    </div>
    <button class="btn btn-primary" onclick="saveAcc()">Save</button>
  </div>
</div>

<script src="/static/js/main.js"></script>
<script>
const icons = { cash: 'ğŸ’µ', card: 'ğŸ’³', upi: 'ğŸ“±' };

async function load() {
  const accs = await MM.get('/api/accounts');
  const el = document.getElementById('accCards');
  if (!accs.length) { el.innerHTML = '<div class="empty">No accounts yet.</div>'; return; }
  el.innerHTML = accs.map(a => `
    <div class="stat-card">
      <div class="stat-label">${icons[a.type]||'ğŸ¦'} ${a.name} (${a.type.toUpperCase()})</div>
      <div class="stat-value" style="color:var(--primary)">${MM.fmt(a.balance)}</div>
      <button class="btn btn-danger btn-sm" style="margin-top:.5rem" onclick="delAcc(${a.id})">Delete</button>
    </div>
  `).join('');
}

async function saveAcc() {
  const name = document.getElementById('accName').value.trim();
  const type = document.getElementById('accType').value;
  const bal  = parseFloat(document.getElementById('accBalance').value) || 0;
  if (!name) return MM.toast('Name required.', 'error');
  await MM.post('/api/accounts', { name, type, balance: bal });
  MM.closeModal('accModal');
  MM.toast('Account added!');
  load();
}

async function delAcc(id) {
  if (!confirm('Delete account?')) return;
  await MM.del('/api/accounts/' + id);
  MM.toast('Deleted.');
  load();
}

load();
</script>
</body>
</html>
